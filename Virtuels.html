<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">

        <title>Documentation Elder EasyCare</title>

         <!-- Bootstrap CSS CDN -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
        <!-- Our Custom CSS -->
        <link rel="stylesheet" href="css/style.css">
    </head>
    <body data-spy="scroll">



        <div class="wrapper">
            <!-- Sidebar Holder -->
            <nav id="sidebar">
                <div class="sidebar-header">
                    <h3>Elders EasyCare</h3>
                </div>

                <ul class="list-unstyled components">
                    <p>Configuration Virtuels</p>
                    <li class="active">

                            <li><a href="#st1">I - Virtuel 2 états</a></li>
                            <li><a href="#st2">II - Virtuel 3 états</a></li>
                            <li><a href="#st3">III - Accès aux valeurs des virtuels</a></li>
			                
                     
                    

                     <li>
                        
<!--

                        <a href="#pageSubmenu" data-toggle="collapse" aria-expanded="false"></a>
                        <ul class="collapse list-unstyled" id="pageSubmenu">
                            <li><a href="#"></a></li>
                            <li><a href="#"></a></li>
                            <li><a href="#"></a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="#"></a>
                    </li>
                    <li>
                        <a href="#"></a>
                 
-->



                <ul class="list-unstyled CTAs">
                    <li><a href="https://github.com/MttGhn/index" class="download">GitHub source</a></li>
                    
                </ul>

            </nav>

            <!-- Page Content Holder -->
            <div id="content">

                <nav class="navbar navbar-default">
                    <div class="container-fluid">

                        <div class="navbar-header">
                            <button type="button" id="sidebarCollapse" class="btn btn-info navbar-btn">
                                <i class="glyphicon glyphicon-align-left"></i>
                                <span>Menu</span>
                            </button>
                        </div>

                        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                            <ul class="nav navbar-nav navbar-right">
                                <li><a href="index.html">Preparation OPI PC+</a></li>
                                <li><a href="Sc%C3%A9narios.html">Scénarios</a></li>
                                <li><a href="Virtuels.html">Virtuels</a></li>
                                <li><a href="#"></a></li>
                            </ul>
                        </div>
                    </div>
                </nav>

				<div class="container-fluid">
					<h1>Installation de Armbian Jessie + Elder-EasyCare sur un Orange PiPC+</h1>
				<div class="raw">
				<h2 id="st1">Initialisation de l'Orange Pi +2</h2>
				<div class="col-md-6">




					<!-- Point 1 -->


<p><b>1.</b>
Telecharger l'image Armbian pour OPI+
2 sur leur site officiel Choisir
UBUNTU SERVER
-
LEFGACY
KERNEL
</p>



					<!-- Point 2 -->


<p><b>2.</b>
Formater la micro SD avec
SDformatter
puis charger l'image sur la
même
micro SD
dument
formatée
avec Win32DiskImager
</p>


					<!-- Point 3 -->



<p><b>3.</b>
Insérer la carte micro SD dans l’OrangePI+ 2 brancher clavier, écran, et l'alimentation. Apres démarrage
s’identifier avec les identifiant/mot_de_passe par défaut:
root/1234
. Confirmez une nouvelle fois
1234
, puis
créez lui un nouveau
MOT_DE_PASSE
. Confir
mez
MOT_DE_PASSE
. Il vous demande maintenant de
creer un nouvel utilisateur. Déclinez en pressant simultanément
CTRL+C
</p>



					<!-- Point 4 -->



<p><b>4.</b>
Maintenant on va copier le contenu de la carte Micro SD sur la mémoire EMMC avec la commande
suivante :
	<code>sudo nand-sata-install</code>
(Acceptez tout en appuyant 3x sur ENTER). Cela dure 30 minutes environ.

A la fin choisir Power OFF
</p>


					<!-- Point 5 -->


<p><b>5.</b>
Eteindre l'Orange PI+ 2
sudo poweroff
retirer la SD du lecteur, Rebranchez l'alimentation pour démarrer l’OPI+2...
Là on va le configurer. Clavier :

<code>dpkg-reconfigure  keyboard-configuration</code>

</p>






				</div>


				<div class="col-md-6">
					                <p>Generic 105 key (intl)PC
-
> French
-
> Français
-
> The default for the keyboard layout
-
> No compose key
Timezone :
<code>dpkg-reconfigure tzdata</code>
Choisissez EUROPE
-
> PARIS, c'est fait!</p>


					<!-- Point 6 -->


<p><b>6.</b>
Initialiser le WIFI par la
commande suivante :
<code>sudo nmtui</code>
Choisissez ACTIVATE A CONNECTION
-
> Choisissez votre wifi
-
> Entrez le MdP, c'est fait!
</p>



					<!-- Point 7 -->


<p><b>7.</b>
Redémarrez pour rendre effectifs les changements
<code>sudo reboot</code>
</p>



					<!-- Point 8 -->


                <p><b>8.</b>
Actualisez les sources
<code>sudo apt-get update</code> puis, redémarrez pour rendre effectifs les
changements sudo reboot</p>


					<!-- Point 9 -->


                <p><b>9.</b>
Appliquez les changements avec les nouvelles sources
<code>sudo apt-get upgrade</code>
Cette Opération dure environ 25 minutres.</p>
                <p>

<code> sudo reboot </code> </p>







                <p></p>
                <p></p>

				</div>
				</div>
				</div>
				<div class="line"></div>



                <div class="container-fluid">
				<div class="raw">
				<h2 id="st2">Préparation et installation du logiciel</h2>
				<div class="col-md-6">



					<!-- Point 10 -->



                <p><b>10.</b>
Installez manuellement MYSQL avant d'executer le script jeedom
<code> sudo apt-get install mysql-server </code>
(Definir le MDP pour root
pendant l’installation : MOT_DE_PASSE_DE_VOTRE_CHOIX)</p>


					<!-- Point 11 -->


                <p><b>11.</b>
installer depuis une source github
, la dernière version de JEEDOM.
Code :
Tout sélectionner <br>  <code> wget https://raw.githubusercontent.com/jeedom/core/stable/install/install.sh </code> </p>



					<!-- Point 12 -->


               <p><b>12.</b>
Rendre executable install.sh
<code> chmod +x install.sh </code>
(rend
exécutable
install.sh)</p>


					<!-- Point 13 -->



                   <p><b>13.</b>
Attention a ne pas poursuivre cette étape, si l'étape 10 n'a pas été bien exécutée.
Exécuter install.sh en donnant le mot de passe prédéfini durant l'installation
<code> sudo ./install.sh –m MOT_DE_PASSE_DE_VOTRE_CHOIX</code>. L’opération va durer environ 20 minutes, JEEDOM va s’installer. Une foi l’installation finie, redémarrer
<code> sudo reboot </code>
Maintenant, on peut passer sur l’ordianteur pour avoir acces à Jeedom via le navigateur internet à l’adresse
ip fournie par le routeur, ou
via l’invité de commande BASH dispo sous win10 ou Ubuntu en connexion
SSH. </p>
                <p></p>
                <p></p>


				</div>


				<div class="col-md-6">

                <p>Egalement on peut se connecter en SSH avec FileZilla pour visualiser graphiquement les fichiers du
serveur.<br>



			<!-- Point 14 -->



<b>14.</b> Une fois installé se connecter en SSH à travers BASH. Par la
commande
<code>ssh root@192.168.0.xx</code>
Si le message «
Warning remote host identification
changed
» apparait c’est normal, pas de panique.
Cela survient généralement après une reinstallation.
C’est parce que la version SSH
-
Client (qui essaie de
se connecter à
SSH
-
Server située sur le serv
eur
que l’on essaie de joindre) détecte un changement de
serveur pour la
même
adresse IP. Etant donné qu’
on a formaté cela parait logique
. Cette sécurité
empêche
qu’un pirate fasse un clone de ton serveur sans que tu ne t’en re
ndes compte.
Exécuter
le code suivant
permet à SSH
-
Client d’oublier l’ancien serveur. Un foi sa mémoire vide il acceptera ne nouveau.
<code>ssh-keygen –R 192.168.x.xxx</code>
Cette commande signifie
: Vider le cache concernant cette IP.</p>


				</div>
				</div>
				</div>
				<div class="line"></div>

     <div class="container-fluid">
				<div class="raw">
				<h2 id="st3">Sécurisation du serveur Linux</h2>
				<div class="col-md-12">


					<!-- Point 15 -->


                <p><b>15.</b> Maintenant on va sécuriser l'accès ssh par une double authentification. 2FA ( deux facteurs d'authentification). Il faut don déjà installer le logiciel google authenticator <code> sudo apt-get install libpam-google-authenticator</code>.
			En suite il faut telecharger google authenticator sur le smartphone. Une fois l'app installée, lancer la commande <code>google-authenticator</code>. Scanner le QR code avec l'app Google Authenticator. Répondre Yes aux 4 questions. Maintenant il faut configurer le serveur.
			Pour cela il faut ouvrir la config de la librairie pam par le code suivant :
			<code>sudo nano /etc/pam.d/sshd</code> et rajouter tout en bas du document "auth required pam_google_authenticator.so". Enregistrer et fermer. Désormais il faut configurer le prgroamme openssh et lui faire admettre la double authetification. Pour cela :
			<code>sudo nano /etc/ssh/sshd_config</code> puis changer la ligne "ChallengeResponseAuthentication no" en "ChallengeResponseAuthentication yes".
			Pour la prise en compte on va redémarrer le service openssh : <code>sudo service sshd restart</code> .
			Tout est prêt. Si vous etes déjà connecté en ssh, ne pas fermer la cession, ouvrir un nouveau terminal et essayer. Ainsi si ça ne fonctionne pas, la connexion au serveur distant n'est pas perdue.
			</p>

				</div>



				</div>
				</div>
				<div class="line"></div>

		<div class="container-fluid">
		<div class="raw">

                <h2 id="st4">Configuration du DynHost OVH</h2>



			<!-- Point 16 -->




<p><b>16.</b> Configuration du DynHost OVH.

<br>
<br>
Le procéder de création du DNS sur OVH se fait dans la section "domaine", séléctionnez le domaine elder-easycare, puis allez dans le menu "DynHost".
<br>
<br>
Pour créer un DynHost sur OVH il faut commencer par créer un DynHost en ciblant l'adresse IP publique voulue, en l'occurence celle de la box du bénéficiaire.
Après quoi, on se rend dans le menu "Gérer les accès", on y crée un identfiant, déféni le suffixe de l’identifiant, le sous-domaine, login et mot de passe.
<br>
<br>
Lien d'un tuto de configuration de DynHost d'OVH : https://www.p3ter.fr/gestion-du-dyndns-sous-linux-avec-ovh.html
<br>
<br>
Exemple :
<br>
<br>
DynHost : jeedom.elder-easycare.fr
<br>
Suffixe identifiant : elder-easycare.fr-andrea (dans le fichier.conf il sera noté dans la partie login comme si dessous)
<br>
Sous-domaine : jeedom.elder-easycare.fr (correspond à l'url du DNS)
<br>
Mot de passe : "mot de passe habituel"

<br>
<br>
Installation de ddclient.conf :

<br>
<br>
Installation : sudo apt-get install ddclient
<br>
<br>
Editer le fichier /etc/ddclient.conf avec la commande nano.
<br>
<br>
Le fichier par défaut, sera comme si dessous :
<br>
<br>
# Configuration file for ddclient generated by debconf
<br>
#
<br>
# /etc/ddclient.conf
<br>
protocol=dyndns2
<br>
use=web, web=checkip.dyndns.com
<br>
server=www.ovh.com
<br>
<b>login=nomdedomaine.net-login
<br>
password='MDP_du_compte_de_gestion_dynhost'
<br>
sous.nomdedomaine.fr_lié_au_compte_de_gestion</b>
<br>
<br>
Les trois données notables à changer seront celles, noté en gras, qui correspondent aux données éditées sur le site d’OVH. A quoi on ajoutera la commande daemon=x, qui permet de donner une unité de temps et ainsi, d’exécuter la commande tous les X minutes, heures, etc. (1 minute de tempo : daemon=60).
<br>
<br>
Fichier ddclient.conf fonctionnel le 25/04/2018 :
<br>
<br>
daemon=60
<br>
protocol=dyndns2
<br>
use=web, web=checkip.dyndns.com
<br>
server=www.ovh.com
<br>
login=elder-easycare.fr-andrea
<br>
password='mot de passe habituel'
<br>
jeedom.elder-easycare.fr
<br>
<br>
On peut également y ajouter d’autre lignes, correspondant à d’autre paramètre, comme si dessous :
<br>
<br>
daemon=600                  # check every 600 seconds
<br>
syslog=yes                  # log update msgs to syslog
<br>
mail=root                   # mail all msgs to root
<br>
mail-failure=root           # mail failed update msgs to root
<br>
pid=/var/run/ddclient.pid   # record PID in file.
<br>
cache=/tmp/ddclient.cache   # Cache file
<br>
ssl=yes                     #Protocol ssl
<br>
### Select one of these options to determine your IP address
<br>
## via hardware interface (if you don't have a router/firewall)
<br>
#use=if, if=eth0
<br>
## via our CheckIP server
<br>
use=web, web=checkip.dyndns.com/, web-skip='IP Address'
<br>
## from the status page for a linksys router/firewall
<br>
#use=linksys, fw=linksys, fw-login=admin, fw-password=admin
<br>
## from a FW status page
<br>
#fw-login=admin, fw-password=XXXXXX
<br>
#use=fw, fw=192.168.1.254/status.htm, fw-skip='IP Address'
<br>
<br>
 ## Enter your Ovh DynHost username and password here
<br>
login=your-login           # your Ovh DynHost username
<br>
password=your-password     # your Ovh DynHost password
<br>
## This section requires no changes unless you need to set a default proxy server
## or you need to bypass your proxy server (because it interferes with the updates)
<br>
protocol=dyndns2                    # default protocol
<br>
server=www.ovh.com           # default server
<br>
#server=members.dyndns.org:8245     # default server (bypassing proxies)
<br>
#proxy=fasthttp.sympatico.ca:80     # default proxy
<br>
## Default options for Dynamic/Static DNS Hosts
<br>
#mx=             # default MX host (leave undefined by default)
<br>
#backupmx=NO     # MX host is primary MX? (leave undefined by default)
<br>
#wildcard=YES     # add wildcard CNAME?
<br>
## Dynamic DNS hosts go here
<br>
votre.domaine.com
<br>
## Static DNS hosts go here
<br>
#static=yes, your-static-host.dyndns.org,another-static-host.dyndns.org
<br>
## Custom DNS hosts go here
<br>
#custom=yes, your-domain.top-level,your-other-domain.top-level
<br>

			</p>
            </div>
        </div>






        <!-- jQuery CDN -->
         <script src="https://code.jquery.com/jquery-1.12.0.min.js"></script>
         <!-- Bootstrap Js CDN -->
         <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
         <!-- jQuery Nicescroll CDN -->
         <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.nicescroll/3.6.8-fix/jquery.nicescroll.min.js"></script>

         <script type="text/javascript">
             $(document).ready(function () {
                 $("#sidebar").niceScroll({
                     cursorcolor: '#53619d',
                     cursorwidth: 4,
                     cursorborder: 'none'
                 });

                 $('#sidebarCollapse').on('click', function () {
                     $('#sidebar, #content').toggleClass('active');
                     $('.collapse.in').toggleClass('in');
                     $('a[aria-expanded=true]').attr('aria-expanded', 'false');
                 });
             });
			 $('body').scrollspy({target: ".navbar"})
         </script>
    </body>
</html>

<!-- STRUCTURE DE DIV paragrpahe double!

<div class="container-fluid">
<div class="raw">
<h1>Collapsible Sidebar Using Bootstrap 3</h1>
<div class="col-md-6">

	<p></p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>


	</div>


	<div class="col-md-6">

     <p></p>
     <p></p>
     <p></p>
     <p></p>
     <p></p>
     <p></p>

		</div>
		</div>
		</div>
		<div class="line"></div>
-->

<!--
STRUCTURE D UN PARAGRAPHE SIMPLE

<div class="container-fluid">
<div class="raw">
<h1>Collapsible Sidebar Using Bootstrap 3</h1>


	<p></p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>


		</div>
		</div>

<div class="line"></div>
-->
